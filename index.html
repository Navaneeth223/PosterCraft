<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PosterCraft - Custom Poster Creator</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="light">
  <header>
    <h1>PosterCraft</h1>
    <button onclick="toggleMode()">Toggle Dark/Light</button>
  </header>
  
  <div class="toolbar">
    <button onclick="addText()">Add Text</button>
    <button onclick="uploadImage()">Upload Image</button>
    <button onclick="exportPNG()">Export PNG</button>
    <button onclick="exportPDF()">Export PDF</button>
    <button onclick="saveTemplate()">Save</button>
    <button onclick="loadTemplate()">Load</button>
    <input type="text" id="aiPrompt" placeholder="Generate Image Prompt"/>
    <button onclick="generateAIImage()">AI Generate</button>
  </div>

  <canvas id="posterCanvas" width="800" height="1000"></canvas>

  <input type="file" id="imageUpload" style="display:none" accept="image/*"/>

  <script>
    const canvas = new fabric.Canvas('posterCanvas');
    canvas.setBackgroundColor('#ffffff', canvas.renderAll.bind(canvas));

    function toggleMode() {
      document.body.classList.toggle('dark');
      document.body.classList.toggle('light');
    }

    function addText() {
      const text = new fabric.Textbox('Your Text Here', {
        left: 100,
        top: 100,
        fontSize: 32,
        fill: '#000'
      });
      canvas.add(text);
    }

    function uploadImage() {
      document.getElementById('imageUpload').click();
    }

    document.getElementById('imageUpload').addEventListener('change', function (e) {
      const reader = new FileReader();
      reader.onload = function (f) {
        const data = f.target.result;
        fabric.Image.fromURL(data, function (img) {
          canvas.add(img);
        });
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function exportPNG() {
      const dataURL = canvas.toDataURL({ format: 'png' });
      const link = document.createElement('a');
      link.download = 'poster.png';
      link.href = dataURL;
      link.click();
    }

    async function exportPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'pt', [canvas.width, canvas.height]);
      const imgData = canvas.toDataURL('image/png');
      pdf.addImage(imgData, 'PNG', 0, 0);
      pdf.save('poster.pdf');
    }

    function saveTemplate() {
      const json = JSON.stringify(canvas.toJSON());
      localStorage.setItem('posterTemplate', json);
    }

    function loadTemplate() {
      const json = localStorage.getItem('posterTemplate');
      if (json) {
        canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));
      }
    }

    async function generateAIImage() {
      const prompt = document.getElementById('aiPrompt').value;
      if (!prompt) return alert('Enter a prompt');
      const response = await fetch('http://localhost:3000/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });
      const data = await response.json();
      fabric.Image.fromURL(data.imageUrl, function (img) {
        canvas.add(img);
      });
    }
  </script>
  <script src=".//script.js"></script>
</body>
</html>
